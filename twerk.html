<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TwerkTok - La plateforme de vid√©os</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 85px;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px;
            border-right: 1px solid #222;
            position: fixed;
            height: 100%;
            z-index: 100;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            color: #FF2E63;
            margin-bottom: 50px;
            background: linear-gradient(45deg, #FF2E63, #FF8E53);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            width: 100%;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            color: #fff;
            text-decoration: none;
            width: 100%;
            padding: 15px 0;
            transition: all 0.3s;
            position: relative;
        }

        .nav-item:hover, .nav-item.active {
            color: #FF2E63;
            background: rgba(255, 46, 99, 0.1);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: #FF2E63;
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 85px;
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        .video-container {
            height: 100vh;
            width: 100%;
            position: relative;
            scroll-snap-align: start;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2;
            opacity: 1;
            transition: opacity 0.3s;
        }

        .video-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .play-btn {
            font-size: 80px;
            color: #FF2E63;
            cursor: pointer;
            margin-bottom: 20px;
            transition: transform 0.3s;
            animation: pulse 2s infinite;
        }

        .play-btn:hover {
            transform: scale(1.1);
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        /* VIDEO INFO - Nouveau style moins intrusif */
        .video-info {
            position: absolute;
            bottom: 100px;
            left: 30px;
            max-width: 65%;
            z-index: 3;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            opacity: 0.9;
        }

        .video-info:hover {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            opacity: 1;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF2E63, #FF8E53);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 12px;
            border: 2px solid #FF2E63;
        }

        .username {
            font-size: 16px;
            font-weight: 600;
        }

        .video-title {
            font-size: 15px;
            margin-bottom: 8px;
            line-height: 1.3;
            font-weight: 500;
        }

        .video-description {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 10px;
            line-height: 1.4;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .tag {
            background: rgba(255, 46, 99, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            border: 1px solid rgba(255, 46, 99, 0.3);
        }

        .video-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            opacity: 0.8;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* VIDEO CONTROLS - Nouveau style */
        .video-controls {
            position: absolute;
            right: 30px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 3;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 25px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.9;
            transition: all 0.3s ease;
        }

        .video-controls:hover {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            opacity: 1;
        }

        .control-btn {
            background: transparent;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .control-btn:hover {
            transform: scale(1.15);
            background: rgba(255, 255, 255, 0.1);
        }

        .control-btn.active {
            color: #FF2E63;
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            padding: 15px 0;
            border-top: 1px solid #222;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .bottom-nav-items {
            display: flex;
            justify-content: space-around;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }

        .bottom-nav-item.active {
            color: #FF2E63;
        }

        .bottom-nav-item i {
            font-size: 22px;
            margin-bottom: 5px;
        }

        /* Upload Modal */
        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .upload-modal.active {
            display: flex;
        }

        .upload-container {
            background: #111;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            border: 1px solid #333;
            position: relative;
        }

        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .upload-header h2 {
            color: #FF2E63;
            font-size: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .upload-form input,
        .upload-form textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            background: #222;
            border: 1px solid #333;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
        }

        .upload-form textarea {
            min-height: 100px;
            resize: vertical;
        }

        .file-upload {
            position: relative;
            margin-bottom: 20px;
        }

        .file-label {
            display: block;
            padding: 20px;
            background: rgba(255, 46, 99, 0.1);
            border: 2px dashed rgba(255, 46, 99, 0.3);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-label:hover {
            background: rgba(255, 46, 99, 0.2);
            border-color: #FF2E63;
        }

        .file-label i {
            font-size: 40px;
            color: #FF2E63;
            margin-bottom: 10px;
            display: block;
        }

        .video-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .video-preview.active {
            display: block;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #FF2E63, #FF8E53);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Status Messages */
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .status-message.success {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
            display: block;
        }

        .status-message.error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
            display: block;
        }

        .status-message.info {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
            display: block;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #FF2E63;
        }

        .loading i {
            margin-right: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* TOGGLE INFO BUTTON */
        .toggle-info-btn {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            z-index: 4;
            backdrop-filter: blur(5px);
            opacity: 0.7;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toggle-info-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.7);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .bottom-nav {
                display: block;
            }
            
            .video-info {
                left: 15px;
                right: 15px;
                max-width: calc(100% - 100px);
                bottom: 80px;
                padding: 12px;
            }
            
            .video-controls {
                right: 15px;
                bottom: 80px;
                padding: 12px;
                gap: 12px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .toggle-info-btn {
                bottom: 90px;
                font-size: 11px;
                padding: 6px 12px;
            }
        }

        @media (max-width: 480px) {
            .video-info {
                max-width: calc(100% - 90px);
                bottom: 70px;
            }
            
            .video-controls {
                right: 10px;
                bottom: 70px;
            }
            
            .user-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .video-title {
                font-size: 14px;
            }
            
            .video-description {
                font-size: 12px;
                max-height: 50px;
            }
        }

        /* Scrollbar */
        .main-content::-webkit-scrollbar {
            width: 8px;
        }

        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .main-content::-webkit-scrollbar-thumb {
            background: rgba(255, 46, 99, 0.5);
            border-radius: 4px;
        }

        .main-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 46, 99, 0.8);
        }
    </style>
</head>
<body>
    <!-- Firebase Status -->
    <div class="status-message info" id="firebase-status" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
        <i class="fas fa-database"></i> Base: twerktok
    </div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">TT</div>
            <a href="#" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </a>
            <a href="#" class="nav-item" id="search-btn">
                <i class="fas fa-search"></i>
                <span>Recherche</span>
            </a>
            <a href="#" class="nav-item" id="upload-btn">
                <i class="fas fa-plus-circle"></i>
                <span>Cr√©er</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-comment"></i>
                <span>Messages</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </a>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="video-feed">
            <div class="loading" id="loading">
                <i class="fas fa-spinner"></i> Chargement des vid√©os...
            </div>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <div class="bottom-nav-items">
                <a href="#" class="bottom-nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Accueil</span>
                </a>
                <a href="#" class="bottom-nav-item">
                    <i class="fas fa-search"></i>
                    <span>Recherche</span>
                </a>
                <a href="#" class="bottom-nav-item" id="upload-btn-mobile">
                    <i class="fas fa-plus-circle"></i>
                    <span>Cr√©er</span>
                </a>
                <a href="#" class="bottom-nav-item">
                    <i class="fas fa-user"></i>
                    <span>Profil</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Upload Modal -->
    <div class="upload-modal" id="upload-modal">
        <div class="upload-container">
            <div class="upload-header">
                <h2>Publier une vid√©o</h2>
                <button class="close-btn" id="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="status-message" id="upload-status"></div>
            
            <form class="upload-form" id="upload-form">
                <input type="text" id="video-title" placeholder="Titre de la vid√©o" required>
                <textarea id="video-description" placeholder="Description (optionnel)"></textarea>
                <input type="text" id="video-creator" placeholder="Votre nom" required>
                
                <video class="video-preview" id="video-preview" controls></video>
                
                <div class="file-upload">
                    <label class="file-label" for="video-file">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>S√©lectionner une vid√©o</span>
                        <br>
                        <small style="opacity: 0.7;">MP4, max 50MB</small>
                    </label>
                    <input type="file" id="video-file" accept="video/*" required style="display: none;">
                </div>
                
                <button type="submit" class="submit-btn" id="submit-btn">
                    <i class="fas fa-upload"></i> Publier sur TwerkTok
                </button>
            </form>
        </div>
    </div>

    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCTj9H9KidzwYDr8Onl_UGqxC58ZlGBMfg",
            authDomain: "test-c81f5.firebaseapp.com",
            projectId: "test-c81f5",
            storageBucket: "test-c81f5.firebasestorage.app",
            messagingSenderId: "94288484954",
            appId: "1:94288484954:web:5b29064b356827c906d663",
            measurementId: "G-6PQX7BFYPC"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        
        // IMPORTANT: Sp√©cifier la base de donn√©es "twerktok"
        const db = getFirestore(app);
        console.log("üìä Base de donn√©es Firestore: twerktok");
        
        const storage = getStorage(app);
        
        // Variables globales
        let videos = [];
        let currentVideoIndex = 0;
        let userInteracted = false;
        let showInfo = true; // Par d√©faut, les infos sont visibles

        // DOM Elements
        const videoFeed = document.getElementById('video-feed');
        const loadingElement = document.getElementById('loading');
        const uploadModal = document.getElementById('upload-modal');
        const uploadBtn = document.getElementById('upload-btn');
        const uploadBtnMobile = document.getElementById('upload-btn-mobile');
        const closeModal = document.getElementById('close-modal');
        const uploadForm = document.getElementById('upload-form');
        const videoFileInput = document.getElementById('video-file');
        const videoPreview = document.getElementById('video-preview');
        const uploadStatus = document.getElementById('upload-status');
        const submitBtn = document.getElementById('submit-btn');
        const firebaseStatus = document.getElementById('firebase-status');

        // Demo videos for initial content
        const demoVideos = [
            {
                id: "welcome",
                title: "üéâ Bienvenue sur TwerkTok !",
                creator: "√âquipe TwerkTok",
                description: "La nouvelle plateforme de partage vid√©o. Publie ta premi√®re vid√©o !",
                tags: ["bienvenue", "premiere", "tiktok"],
                music: "Son TwerkTok Original",
                url: "https://assets.mixkit.co/videos/preview/mixkit-group-of-friends-partying-happily-4640-large.mp4",
                likes: 128,
                shares: 42,
                views: 1000,
                timestamp: new Date().toISOString()
            }
        ];

        // Charger les vid√©os depuis la base de donn√©es "twerktok"
        async function loadVideos() {
            try {
                console.log("üîç Chargement des vid√©os depuis la base 'twerktok'...");
                
                // Utiliser la collection "videos" dans la base "twerktok"
                const videosRef = collection(db, "videos");
                const q = query(videosRef, orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                videos = [];
                
                if (!querySnapshot.empty) {
                    querySnapshot.forEach((doc) => {
                        const videoData = doc.data();
                        videoData.id = doc.id;
                        videos.push(videoData);
                    });
                    
                    console.log(`‚úÖ ${videos.length} vid√©o(s) charg√©e(s) depuis la base 'twerktok'`);
                    firebaseStatus.innerHTML = `<i class="fas fa-database"></i> Base: twerktok (${videos.length} vid√©os)`;
                    
                } else {
                    console.log("üì≠ La base 'twerktok' est vide, ajout d'une vid√©o de bienvenue");
                    firebaseStatus.innerHTML = `<i class="fas fa-database"></i> Base: twerktok (vide)`;
                    
                    // Ajouter une vid√©o de bienvenue
                    await addWelcomeVideo();
                    await loadVideos(); // Recharger
                    return;
                }
                
            } catch (error) {
                console.error("‚ùå Erreur de chargement:", error);
                
                // Afficher un message d'erreur
                firebaseStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Erreur de chargement`;
                firebaseStatus.className = "status-message error";
                
                // Utiliser les vid√©os de d√©mo
                videos = [...demoVideos];
            }
            
            loadingElement.style.display = 'none';
            renderVideos();
        }

        // Ajouter une vid√©o de bienvenue √† la base "twerktok"
        async function addWelcomeVideo() {
            try {
                const welcomeVideo = {
                    title: "üé¨ Bienvenue sur TwerkTok !",
                    creator: "√âquipe TwerkTok",
                    description: "Premi√®re vid√©o dans la base de donn√©es TwerkTok. Publie la tienne !",
                    tags: ["bienvenue", "twerktok", "premiere"],
                    music: "Son TwerkTok",
                    url: "https://assets.mixkit.co/videos/preview/mixkit-group-of-friends-partying-happily-4640-large.mp4",
                    likes: 0,
                    shares: 0,
                    views: 0,
                    timestamp: serverTimestamp()
                };
                
                await addDoc(collection(db, "videos"), welcomeVideo);
                console.log("‚úÖ Vid√©o de bienvenue ajout√©e √† la base 'twerktok'");
                
            } catch (error) {
                console.error("‚ùå Erreur ajout vid√©o bienvenue:", error);
            }
        }

        // Afficher les vid√©os
        function renderVideos() {
            videoFeed.innerHTML = '';
            
            if (videos.length === 0) {
                videoFeed.innerHTML = `
                    <div class="video-container" style="display: flex; justify-content: center; align-items: center;">
                        <div class="video-overlay">
                            <div style="text-align: center; padding: 30px;">
                                <i class="fas fa-video-slash" style="font-size: 60px; color: #FF2E63; margin-bottom: 20px;"></i>
                                <h2 style="margin-bottom: 10px;">Aucune vid√©o</h2>
                                <p style="margin-bottom: 30px; opacity: 0.8;">Sois le premier √† publier !</p>
                                <button onclick="openUploadModal()" style="padding: 15px 30px; background: #FF2E63; border: none; border-radius: 10px; color: white; font-size: 16px; cursor: pointer;">
                                    <i class="fas fa-plus"></i> Publier une vid√©o
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            videos.forEach((video, index) => {
                const videoContainer = document.createElement('div');
                videoContainer.className = 'video-container';
                videoContainer.id = `video-${index}`;
                
                // Format date
                const videoDate = video.timestamp ? new Date(video.timestamp).toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                }) : '';
                
                videoContainer.innerHTML = `
                    <video class="video-player" loop playsinline preload="metadata">
                        <source src="${video.url}" type="video/mp4">
                    </video>
                    
                    <div class="video-overlay" id="overlay-${index}">
                        <div class="play-btn" onclick="playVideo(${index})">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <p>Appuie pour d√©marrer la vid√©o</p>
                    </div>
                    
                    <!-- Info Panel -->
                    <div class="video-info" id="info-${index}" style="${showInfo ? '' : 'display: none;'}">
                        <div class="user-info">
                            <div class="user-avatar">${video.creator.charAt(0).toUpperCase()}</div>
                            <div>
                                <div class="username">${video.creator}</div>
                                <div style="font-size: 12px; opacity: 0.7;">${videoDate}</div>
                            </div>
                        </div>
                        <div class="video-title">${video.title}</div>
                        <div class="video-description">${video.description}</div>
                        <div class="video-tags">
                            ${video.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                        <div class="video-stats">
                            <div class="stat">
                                <i class="fas fa-heart"></i>
                                <span>${video.likes || 0}</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-share"></i>
                                <span>${video.shares || 0}</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-eye"></i>
                                <span>${video.views || 0}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Controls Panel -->
                    <div class="video-controls" id="controls-${index}" style="${showInfo ? '' : 'display: none;'}">
                        <button class="control-btn" onclick="likeVideo('${video.id}', ${index})" title="J'aime">
                            <i class="${video.liked ? 'fas' : 'far'} fa-heart"></i>
                        </button>
                        <button class="control-btn" onclick="shareVideo(${index})" title="Partager">
                            <i class="fas fa-share"></i>
                        </button>
                        <button class="control-btn" onclick="commentVideo(${index})" title="Commenter">
                            <i class="fas fa-comment"></i>
                        </button>
                    </div>
                    
                    <!-- Toggle Info Button -->
                    <button class="toggle-info-btn" onclick="toggleInfo()" id="toggle-${index}">
                        <i class="fas fa-${showInfo ? 'eye-slash' : 'eye'}"></i>
                        ${showInfo ? 'Masquer' : 'Afficher'}
                    </button>
                `;
                
                videoFeed.appendChild(videoContainer);
                
                // Setup video events
                const videoElement = videoContainer.querySelector('.video-player');
                if (videoElement) {
                    videoElement.addEventListener('click', () => togglePlayPause(index));
                }
            });
            
            // Setup scroll handling
            setupScrollHandler();
            
            // Auto-play first video if user interacted
            if (userInteracted) {
                playCurrentVideo();
            }
        }

        // Setup scroll handler
        function setupScrollHandler() {
            videoFeed.addEventListener('scroll', handleScroll, { passive: true });
        }

        // Handle scroll
        function handleScroll() {
            const newIndex = Math.round(videoFeed.scrollTop / window.innerHeight);
            
            if (newIndex !== currentVideoIndex) {
                // Pause previous video
                const prevVideo = document.querySelector(`#video-${currentVideoIndex} .video-player`);
                if (prevVideo) {
                    prevVideo.pause();
                    document.getElementById(`overlay-${currentVideoIndex}`).classList.remove('hidden');
                }
                
                currentVideoIndex = newIndex;
                
                // Play new video if user interacted
                if (userInteracted) {
                    playCurrentVideo();
                }
            }
        }

        // Play current video
        function playCurrentVideo() {
            if (!userInteracted) return;
            
            const video = document.querySelector(`#video-${currentVideoIndex} .video-player`);
            const overlay = document.getElementById(`overlay-${currentVideoIndex}`);
            
            if (video && overlay) {
                video.play()
                    .then(() => {
                        overlay.classList.add('hidden');
                        updateVideoViews(currentVideoIndex);
                    })
                    .catch(error => {
                        console.log("Lecture automatique bloqu√©e:", error);
                        overlay.classList.remove('hidden');
                    });
            }
        }

        // Play specific video
        window.playVideo = function(index) {
            userInteracted = true;
            const video = document.querySelector(`#video-${index} .video-player`);
            const overlay = document.getElementById(`overlay-${index}`);
            
            if (video && overlay) {
                video.play()
                    .then(() => {
                        overlay.classList.add('hidden');
                        updateVideoViews(index);
                    })
                    .catch(error => {
                        console.error("Erreur de lecture:", error);
                        overlay.innerHTML = `
                            <div style="text-align: center;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 60px; color: #FF2E63; margin-bottom: 20px;"></i>
                                <p>Impossible de lire la vid√©o</p>
                                <button onclick="playVideo(${index})" style="margin-top: 20px; padding: 10px 20px; background: #FF2E63; border: none; border-radius: 8px; color: white; cursor: pointer;">
                                    R√©essayer
                                </button>
                            </div>
                        `;
                    });
            }
        };

        // Toggle play/pause
        function togglePlayPause(index) {
            const video = document.querySelector(`#video-${index} .video-player`);
            const overlay = document.getElementById(`overlay-${index}`);
            
            if (video.paused) {
                video.play();
                if (overlay) overlay.classList.add('hidden');
            } else {
                video.pause();
                if (overlay) overlay.classList.remove('hidden');
            }
        }

        // Toggle info visibility
        window.toggleInfo = function() {
            showInfo = !showInfo;
            
            // Update all info panels
            videos.forEach((_, index) => {
                const infoPanel = document.getElementById(`info-${index}`);
                const controlsPanel = document.getElementById(`controls-${index}`);
                const toggleBtn = document.getElementById(`toggle-${index}`);
                
                if (infoPanel && controlsPanel && toggleBtn) {
                    if (showInfo) {
                        infoPanel.style.display = 'block';
                        controlsPanel.style.display = 'flex';
                        toggleBtn.innerHTML = `<i class="fas fa-eye-slash"></i> Masquer`;
                    } else {
                        infoPanel.style.display = 'none';
                        controlsPanel.style.display = 'none';
                        toggleBtn.innerHTML = `<i class="fas fa-eye"></i> Afficher`;
                    }
                }
            });
        };

        // Update video views
        function updateVideoViews(index) {
            if (videos[index]) {
                videos[index].views = (videos[index].views || 0) + 1;
                
                // Update display
                const viewsElement = document.querySelector(`#video-${index} .video-stats .stat:nth-child(3) span`);
                if (viewsElement) {
                    viewsElement.textContent = videos[index].views;
                }
                
                // TODO: Update in Firebase
                console.log(`Vues mises √† jour pour la vid√©o ${index}: ${videos[index].views}`);
            }
        }

        // Handle file selection
        videoFileInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const videoURL = URL.createObjectURL(file);
                videoPreview.src = videoURL;
                videoPreview.classList.add('active');
            }
        });

        // Handle upload
        uploadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('video-title').value.trim();
            const description = document.getElementById('video-description').value.trim();
            const creator = document.getElementById('video-creator').value.trim();
            const file = videoFileInput.files[0];
            
            // Validation
            if (!title || !creator || !file) {
                showUploadStatus("Veuillez remplir tous les champs", "error");
                return;
            }
            
            if (file.size > 50 * 1024 * 1024) {
                showUploadStatus("La vid√©o est trop volumineuse (max 50MB)", "error");
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publication en cours...';
            
            try {
                showUploadStatus("T√©l√©chargement vers le dossier 'twerktok'...", "info");
                
                // Upload to Firebase Storage in 'twerktok' folder
                const storagePath = `twerktok/videos/${Date.now()}_${file.name}`;
                const storageRef = ref(storage, storagePath);
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                showUploadStatus("Sauvegarde dans la base 'twerktok'...", "info");
                
                // Save to Firestore in 'twerktok' database
                const videoData = {
                    title: title,
                    description: description || "",
                    creator: creator,
                    tags: ["twerktok", "nouveau"],
                    music: "Son original",
                    url: downloadURL,
                    storagePath: storagePath,
                    likes: 0,
                    shares: 0,
                    views: 0,
                    timestamp: serverTimestamp()
                };
                
                // Add to 'videos' collection in 'twerktok' database
                const docRef = await addDoc(collection(db, "videos"), videoData);
                console.log(`‚úÖ Vid√©o publi√©e avec ID: ${docRef.id} dans la base 'twerktok'`);
                
                showUploadStatus("‚úÖ Vid√©o publi√©e avec succ√®s !", "success");
                
                // Add to local array and reload
                videoData.id = docRef.id;
                videos.unshift(videoData);
                
                setTimeout(() => {
                    closeUploadModal();
                    renderVideos();
                    // Scroll to top
                    videoFeed.scrollTo({ top: 0, behavior: 'smooth' });
                }, 2000);
                
            } catch (error) {
                console.error("‚ùå Erreur d'upload:", error);
                showUploadStatus(`Erreur: ${error.message}`, "error");
                
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-upload"></i> Publier sur TwerkTok';
            }
        });

        // Modal functions
        function openUploadModal() {
            uploadModal.classList.add('active');
            uploadStatus.textContent = '';
            uploadStatus.className = 'status-message';
        }

        function closeUploadModal() {
            uploadModal.classList.remove('active');
            uploadForm.reset();
            videoPreview.classList.remove('active');
            videoPreview.src = '';
        }

        // Show upload status
        function showUploadStatus(message, type) {
            uploadStatus.textContent = message;
            uploadStatus.className = `status-message ${type}`;
        }

        // Event listeners
        uploadBtn.addEventListener('click', openUploadModal);
        uploadBtnMobile.addEventListener('click', openUploadModal);
        closeModal.addEventListener('click', closeUploadModal);
        
        uploadModal.addEventListener('click', function(e) {
            if (e.target === uploadModal) {
                closeUploadModal();
            }
        });

        // Global click to start interaction
        document.addEventListener('click', () => {
            if (!userInteracted) {
                userInteracted = true;
                playCurrentVideo();
            }
        }, { once: true });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    const video = document.querySelector(`#video-${currentVideoIndex} .video-player`);
                    if (video) {
                        if (video.paused) {
                            video.play();
                            document.getElementById(`overlay-${currentVideoIndex}`).classList.add('hidden');
                        } else {
                            video.pause();
                            document.getElementById(`overlay-${currentVideoIndex}`).classList.remove('hidden');
                        }
                    }
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    if (currentVideoIndex < videos.length - 1) {
                        videoFeed.scrollTo({
                            top: (currentVideoIndex + 1) * window.innerHeight,
                            behavior: 'smooth'
                        });
                    }
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    if (currentVideoIndex > 0) {
                        videoFeed.scrollTo({
                            top: (currentVideoIndex - 1) * window.innerHeight,
                            behavior: 'smooth'
                        });
                    }
                    break;
                case 'i':
                case 'I':
                    e.preventDefault();
                    toggleInfo();
                    break;
            }
        });

        // Interaction functions
        window.likeVideo = function(videoId, index) {
            const likeBtn = document.querySelector(`#video-${index} .fa-heart`);
            const isLiked = likeBtn.classList.contains('fas');
            
            if (isLiked) {
                likeBtn.classList.remove('fas');
                likeBtn.classList.add('far');
                if (videos[index]) videos[index].likes = Math.max(0, (videos[index].likes || 0) - 1);
            } else {
                likeBtn.classList.remove('far');
                likeBtn.classList.add('fas');
                likeBtn.style.color = '#FF2E63';
                if (videos[index]) videos[index].likes = (videos[index].likes || 0) + 1;
            }
            
            // Update display
            const likesElement = document.querySelector(`#video-${index} .video-stats .stat:nth-child(1) span`);
            if (likesElement && videos[index]) {
                likesElement.textContent = videos[index].likes;
            }
            
            console.log(`Like pour vid√©o ${videoId} dans la base 'twerktok'`);
        };

        window.shareVideo = function(index) {
            const video = videos[index];
            
            if (navigator.share) {
                navigator.share({
                    title: `TwerkTok: ${video.title}`,
                    text: video.description,
                    url: window.location.href,
                }).then(() => {
                    if (videos[index]) {
                        videos[index].shares = (videos[index].shares || 0) + 1;
                        const sharesElement = document.querySelector(`#video-${index} .video-stats .stat:nth-child(2) span`);
                        if (sharesElement) {
                            sharesElement.textContent = videos[index].shares;
                        }
                    }
                });
            } else {
                alert(`Partager: ${video.title}`);
            }
        };

        window.commentVideo = function(index) {
            alert(`Commentaires pour "${videos[index].title}"\n\nFonctionnalit√© √† venir !`);
        };

        // Initialize the app
        loadVideos();
    </script>
</body>
<div id="clck_ntv"></div>
<script src="https://38443.berostranes.com/v2/a/na/js/269856?container=clck_ntv" async></script>
</html>
